@startuml web5claims-detailed-flow
!theme cerulean-outline

title Web5 Claims - Enhanced ZK Language Learning Certificate Flow with Identity Verification\n**ZK Hack Berlin 2024**

actor "ğŸ‘¨â€ğŸ“\nLanguage Learner" as learner
participant "ğŸ›‚\nZKPassport\nIdentity Verification" as zkpass
participant "ğŸ®\nKonnektoren\nLearning Platform" as konnektoren
participant "ğŸŒ\nWeb5 Claims UI\n(Yew Frontend)" as ui
participant "ğŸ”\nEnhanced Certificate Issuer\n(Rust Backend)" as issuer
participant "âœ…\nEnhanced ZK Proof Verifier\n(Rust Backend)" as verifier
participant "âš™ï¸\nAleo Platform\n(ZK Circuits)" as aleo
participant "ğŸ¢\nEmployer/University\n(Relying Party)" as employer

== ğŸ›‚ Optional Identity Verification ==
learner -> zkpass: Visit /zkpass/ for Identity Verification
activate zkpass

zkpass -> learner: Request First Name Input
learner -> zkpass: Enter "John"

zkpass -> zkpass: Generate ZKPassport Request
note right
**ZKPassport Query:**
```javascript
queryBuilder
  .gte("age", 18)        // Age â‰¥ 18 proof
  .disclose("firstname") // Name verification
  .done()
```
**Privacy:** Proves 18+ without revealing exact age
end note

zkpass -> learner: Display QR Code
learner -> zkpass: Scan with ZKPassport Mobile App
zkpass -> zkpass: Generate ZK Identity Proof

zkpass -> zkpass: Verify Results
note right
**Identity Verification:**
â€¢ Age: 18+ âœ… (actual age hidden)
â€¢ Name: "John" âœ… (surname hidden)
â€¢ Verification Type: "identity"
â€¢ Timestamp: 2024-01-15T09:00:00Z
end note

zkpass -> learner: âœ… "Identity Verified!"
zkpass -> ui: Redirect to /issuer?verified_name=John&verified_age=true
deactivate zkpass

== ğŸ“ Learning & Certificate Generation ==
learner -> konnektoren: Complete German B2 Course
activate konnektoren

konnektoren -> konnektoren: Generate CertificateData
note right
**Certificate Fields:**
â€¢ game_path_name: "German_B2_Complete"
â€¢ total_challenges: 50
â€¢ solved_challenges: 47
â€¢ performance_percentage: 94
â€¢ profile_name: "John" (from identity verification)
â€¢ date: 2024-01-15T10:30:00Z
â€¢ signature: Ed25519 signature
end note

konnektoren -> konnektoren: Sign Certificate with Ed25519
konnektoren -> learner: Issue Signed Certificate
deactivate konnektoren

== ğŸŒ Enhanced Web5 Claims UI Interaction ==
learner -> ui: Open Web5 Claims App (with verified identity)
activate ui

ui -> ui: Parse URL Parameters (verified_name, verified_age)
ui -> learner: Show Pre-filled Certificate Form
note right
**Enhanced UI with Identity:**
â€¢ Name field: Pre-filled with "John" âœ…
â€¢ Identity Badge: "Verified Identity" ğŸ›‚
â€¢ Trust Score: Higher credibility
â€¢ Certificate Type: "Identity-Verified Certificate"
end note

learner -> ui: Input Certificate Data (enhanced with identity)
ui -> ui: Validate Form & Preview with Identity Badge

learner -> ui: Click "ğŸ“ Generate Identity-Verified Certificate"
ui -> ui: Create Enhanced CertificateData Object
ui -> learner: Display Certificate with Identity Verification Badge

== ğŸ” Enhanced ZK Proof Generation ==
learner -> ui: Click "ğŸš€ Generate Enhanced Aleo ZK Proof"
ui -> issuer: Create Enhanced ProofRequest
activate issuer

note over issuer
**Enhanced ProofRequest:**
â€¢ certificate: CertificateData
â€¢ claim_type: Combined {
    language: "German",
    min_level: CefrLevel::B2,
    identity_verified: true
  }
â€¢ target_platform: "aleo"
â€¢ verified_identity: VerifiedIdentity {
    first_name: "John",
    age_verified: true,
    name_verified: true,
    verification_timestamp: "2024-01-15T09:00:00Z"
  }
end note

issuer -> issuer: Validate Certificate + Identity
issuer -> issuer: Generate Enhanced Certificate Hash
issuer -> issuer: Create Identity Commitment

issuer -> aleo: Generate Enhanced ZK Proof
activate aleo

note over aleo
**Enhanced Aleo ZK Circuit: identity_verified_language_v1**
```
transition verify_identity_language_skill(
    private cert_level: u8,           // 4 (B2)
    private performance: u8,          // 94
    private student_hash: field,      // SHA256(profile)
    private identity_verified: bool,  // true
    private age_proof_hash: field,    // ZKPassport age proof
    private name_proof_hash: field,   // ZKPassport name proof
    public min_level: u8,             // 4 (B2)
    public language: field,           // hash("German")
    public requires_identity: bool,   // true
) -> (bool, u8) {
    let skill_valid = cert_level >= min_level;
    let identity_valid = identity_verified;
    let trust_score = if identity_valid { 95u8 } else { 75u8 };
    return (skill_valid && identity_valid, trust_score);
}
```
**Enhanced Proof:** Language skill + Identity verification + Trust score
end note

aleo -> aleo: Execute Enhanced ZK Circuit
aleo -> issuer: Return Enhanced ZK Proof Bytes
deactivate aleo

issuer -> issuer: Create Enhanced ZkProofClaim
note right
**Enhanced ZkProofClaim:**
â€¢ proof_id: UUID
â€¢ claim_type: Combined (Language + Identity)
â€¢ public_inputs: {
    "min_level": "B2",
    "language": "German",
    "identity_verified": true,
    "verification_result": true,
    "trust_score": 95,
    "certificate_hash": "sha256...",
    "identity_hash": "sha256(identity_data)"
  }
â€¢ proof_data: {
    "proof_bytes": [Enhanced ZK proof],
    "circuit_id": "identity_verified_language_v1",
    "vk_hash": "verification_key_hash"
  }
â€¢ identity_verification: VerifiedIdentity
end note

issuer -> ui: Return Enhanced ZkProofClaim
deactivate issuer

ui -> learner: âœ… "Enhanced ZK Proof Generated!\nğŸ›‚ Identity Verified + ğŸ“ Language Skill"
deactivate ui

== ğŸ’¼ Enhanced Employment Verification Scenario ==
learner -> employer: "I have verified German B2+ proficiency with identity"
employer -> learner: "Please provide verifiable proof"

learner -> employer: Submit Enhanced ZK Proof (JSON/Base64)
employer -> verifier: Verify Enhanced ZK Proof
activate verifier

verifier -> verifier: Check Enhanced Proof Integrity
verifier -> verifier: Validate Identity Claims
verifier -> verifier: Check Circuit Trust & Identity Support
note right
**Enhanced Trusted Circuits:**
â€¢ identity_verified_language_v1 âœ… (NEW)
â€¢ language_proficiency_v1 âœ…
â€¢ performance_threshold_v1 âœ…
â€¢ completion_date_v1 âœ…
â€¢ combined_criteria_v1 âœ…
end note

verifier -> aleo: Verify Enhanced Proof On-Chain
activate aleo
aleo -> aleo: Run Enhanced Verification Algorithm
aleo -> verifier: âœ… Enhanced Proof Valid + Trust Score: 95
deactivate aleo

verifier -> verifier: Create Enhanced VerificationResult
note right
**Enhanced VerificationResult:**
â€¢ is_valid: true
â€¢ requirements_met: true
â€¢ identity_verified: true âœ…
â€¢ trust_score: 95 (vs 75 for non-identity)
â€¢ details: {
    "platform": "aleo",
    "circuit_id": "identity_verified_language_v1",
    "verified_at": "2024-01-15T11:00:00Z",
    "identity_verification": {
      "age_verified": true,
      "name_verified": true,
      "verification_timestamp": "2024-01-15T09:00:00Z"
    },
    "verified_inputs": {
      "min_level": "B2",
      "language": "German",
      "identity_verified": true
    }
  }
â€¢ warnings: []
end note

verifier -> employer: Return Enhanced VerificationResult
deactivate verifier

employer -> employer: Process Enhanced Verification
employer -> learner: âœ… "German B2+ Competency + Identity Verified!\nğŸ† High Trust Score: 95/100"

== ğŸ“Š Enhanced Privacy Comparison ==
note over learner, employer
**ğŸ” What was PROVEN (Public):**
âœ… Has German language certification
âœ… Achieved B2 level or higher
âœ… Certificate issued after Jan 2023
âœ… Valid cryptographic signature
âœ… Identity verified (age 18+, first name matches)
âœ… High trust score (95/100)

**âŒ What was HIDDEN (Private):**
âŒ Exact CEFR level (could be B2, C1, or C2)
âŒ Exact performance score (94%)
âŒ Number of challenges completed (47/50)
âŒ Exact age (only proven â‰¥18)
âŒ Surname/last name
âŒ Passport details
âŒ Institution details
âŒ Exact completion date

**ğŸ›‚ ZKPassport Privacy Benefits:**
â€¢ Age verification without revealing exact age
â€¢ Name verification without exposing surname
â€¢ No passport data stored or transmitted
â€¢ Enhanced certificate credibility
â€¢ Higher employer confidence
end note

== ğŸ† Enhanced ZK Hack Berlin Prize Tracks ==
note over ui, aleo
**ğŸ† Enhanced Prize Track Alignment:**
ğŸ¥‡ **Aleo ($5K)**: Enhanced native Aleo ZK circuits for education + identity
ğŸ—ï¸ **Arbitrum Stylus ($1K)**: Rust ZK verifier with identity support
ğŸ” **ZKPassport ($1K)**: âœ… COMPLETE - Private identity verification integration
ğŸ‘¥ **Xion ($3K)**: Consumer-friendly ZK UX with seamless identity flow
ğŸ† **Main Prize ($9K)**: Novel ZK education + identity application

**âœ… ZKPassport Integration Highlights:**
â€¢ Age verification (18+) without revealing exact age
â€¢ First name verification without exposing surname
â€¢ Seamless redirect flow: /zkpass/ â†’ /issuer
â€¢ Enhanced trust scores for verified certificates
â€¢ Privacy-preserving identity enhancement
â€¢ Real-world employment verification scenarios
end note

== ğŸ”„ Alternative Flows ==
note over learner, employer
**ğŸ”„ Flow Variations:**

**1. Standard Certificate (No Identity):**
Learner â†’ Konnektoren â†’ UI â†’ Issuer â†’ Aleo
Trust Score: 75/100

**2. Identity-First Flow:**
Learner â†’ ZKPassport â†’ UI (pre-filled) â†’ Issuer â†’ Enhanced Aleo
Trust Score: 95/100

**3. Employer Requirements:**
- Basic verification: Standard certificate accepted
- High-security roles: Identity verification required
- Automatic trust score filtering by employers
end note

@enduml
